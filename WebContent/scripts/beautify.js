/*

 JS Beautifier
---------------


  Written by Einar Lielmanis, <einar@jsbeautifier.org>
      http://jsbeautifier.org/

  Originally converted to javascript by Vital, <vital76@gmail.com>
  "End braces on own line" added by Chris J. Shull, <chrisjshull@gmail.com>

  You are free to use this in any way you want, in case you find this useful or working for you.

  Usage:
    js_beautify(js_source_text);
    js_beautify(js_source_text, options);

  The options are:
    indent_size (default 4)          — indentation size,
    indent_char (default space)      — character to indent with,
    preserve_newlines (default true) — whether existing line breaks should be preserved,
    preserve_max_newlines (default unlimited) - maximum number of line breaks to be preserved in one chunk,

    jslint_happy (default false) — if true, then jslint-stricter mode is enforced.

            jslint_happy   !jslint_happy
            ---------------------------------
             function ()      function()

    brace_style (default "collapse") - "collapse" | "expand" | "end-expand" | "expand-strict"
            put braces on the same line as control statements (default), or put braces on own line (Allman / ANSI style), or just put end braces on own line.

            expand-strict: put brace on own line even in such cases:

                var a =
                {
                    a: 5,
                    b: 6
                }
            This mode may break your scripts - e.g "return { a: 1 }" will be broken into two lines, so beware.

    space_before_conditional: should the space before conditional statement be added, "if(true)" vs "if (true)"

    e.g

    js_beautify(js_source_text, {
      'indent_size': 1,
      'indent_char': '\t'
    });


*/
function js_beautify(y,l){function D(a){for(a="undefined"===typeof a?!1:a;j.length&&(" "===j[j.length-1]||j[j.length-1]===v||j[j.length-1]===C||a&&("\n"===j[j.length-1]||"\r"===j[j.length-1]));)j.pop()}function M(a){return a.replace(/^\s\s*|\s\s*$/,"")}function S(){var a=r;r=!1;k();r=a}function k(a){b.eat_next_space=!1;if(!r||!E(b.mode))if(a="undefined"===typeof a?!0:a,b.if_line=!1,D(),j.length){if("\n"!==j[j.length-1]||!a)w=!0,j.push("\n");C&&j.push(C);for(a=0;a<b.indentation_level;a+=1)j.push(v); b.var_line&&b.var_line_reindented&&j.push(v);b.case_body&&j.push(v)}}function f(){if("TK_COMMENT"===e)return k(!0);if(b.eat_next_space)b.eat_next_space=!1;else{var a=" ";j.length&&(a=j[j.length-1]);" "!==a&&"\n"!==a&&a!==v&&j.push(" ")}}function m(){w=!1;b.eat_next_space=!1;j.push(d)}function F(){b.indentation_level+=1}function N(){j.length&&j[j.length-1]===v&&j.pop()}function u(a){b&&G.push(b);b={previous_mode:b?b.mode:"BLOCK",mode:a,var_line:!1,var_line_tainted:!1,var_line_reindented:!1,in_html_comment:!1, if_line:!1,in_case:!1,case_body:!1,eat_next_space:!1,indentation_baseline:-1,indentation_level:b?b.indentation_level+(b.case_body?1:0)+(b.var_line&&b.var_line_reindented?1:0):0,ternary_depth:0}}function E(a){return"[EXPRESSION]"===a||"[INDENTED-EXPRESSION]"===a}function H(a){return n(a,["[EXPRESSION]","(EXPRESSION)","(FOR-EXPRESSION)","(COND-EXPRESSION)"])}function I(){J="DO_BLOCK"===b.mode;if(0<G.length){var a=b.mode;b=G.pop();b.previous_mode=a}}function V(a,b){for(var e=0;e<a.length;e++)if(M(a[e])[0]!= b)return!1;return!0}function n(a,b){for(var e=0;e<b.length;e+=1)if(b[e]===a)return!0;return!1}function O(b){for(var e=a,g=h.charAt(e);n(g,K)&&g!=b;){e++;if(e>=p)return 0;g=h.charAt(e)}return g}function P(){s=0;if(a>=p)return["","TK_EOF"];z=!1;var c=h.charAt(a);a+=1;if(r&&E(b.mode)){for(var d=0;n(c,K);){"\n"===c?(D(),j.push("\n"),w=!0,d=0):"\t"===c?d+=4:"\r"!==c&&(d+=1);if(a>=p)return["","TK_EOF"];c=h.charAt(a);a+=1}-1===b.indentation_baseline&&(b.indentation_baseline=d);if(w){var f;for(f=0;f<b.indentation_level+ 1;f+=1)j.push(v);if(-1!==b.indentation_baseline)for(f=0;f<d-b.indentation_baseline;f++)j.push(" ")}}else{for(;n(c,K);){"\n"===c&&(s+=T?s<=T?1:0:1);if(a>=p)return["","TK_EOF"];c=h.charAt(a);a+=1}if(Q&&1<s)for(f=0;f<s;f+=1)k(0===f),w=!0;z=0<s}if(n(c,L)){if(a<p)for(;n(h.charAt(a),L)&&!(c+=h.charAt(a),a+=1,a===p););if(a!==p&&c.match(/^[0-9]+[Ee]$/)&&("-"===h.charAt(a)||"+"===h.charAt(a)))return d=h.charAt(a),a+=1,f=P(a),c+=d+f[0],[c,"TK_WORD"];if("in"===c)return[c,"TK_OPERATOR"];z&&"TK_OPERATOR"!==e&& "TK_EQUALS"!==e&&!b.if_line&&(Q||"var"!==g)&&k();return[c,"TK_WORD"]}if("("===c||"["===c)return[c,"TK_START_EXPR"];if(")"===c||"]"===c)return[c,"TK_END_EXPR"];if("{"===c)return[c,"TK_START_BLOCK"];if("}"===c)return[c,"TK_END_BLOCK"];if(";"===c)return[c,"TK_SEMICOLON"];if("/"===c){d="";f=!0;if("*"===h.charAt(a)){a+=1;if(a<p)for(;!("*"===h.charAt(a)&&h.charAt(a+1)&&"/"===h.charAt(a+1))&&a<p;){c=h.charAt(a);d+=c;if("\r"===c||"\n"===c)f=!1;a+=1;if(a>=p)break}a+=2;return f&&0==s?["/*"+d+"*/","TK_INLINE_COMMENT"]: ["/*"+d+"*/","TK_BLOCK_COMMENT"]}if("/"===h.charAt(a)){for(d=c;"\r"!==h.charAt(a)&&"\n"!==h.charAt(a)&&!(d+=h.charAt(a),a+=1,a>=p););a+=1;z&&k();return[d,"TK_COMMENT"]}}if("'"===c||'"'===c||"/"===c&&("TK_WORD"===e&&n(g,["return","do","else"])||")"===g&&n(b.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])||"TK_COMMENT"===e||"TK_START_EXPR"===e||"TK_START_BLOCK"===e||"TK_END_BLOCK"===e||"TK_OPERATOR"===e||"TK_EQUALS"===e||"TK_EOF"===e||"TK_SEMICOLON"===e)){d=c;f=!1;var i=c;if(a<p)if("/"===d)for(c= !1;f||c||h.charAt(a)!==d;){if(i+=h.charAt(a),f?f=!1:(f="\\"===h.charAt(a),"["===h.charAt(a)?c=!0:"]"===h.charAt(a)&&(c=!1)),a+=1,a>=p)return[i,"TK_STRING"]}else for(;f||h.charAt(a)!==d;)if(i+=h.charAt(a),f=f?!1:"\\"===h.charAt(a),a+=1,a>=p)return[i,"TK_STRING"];a+=1;i+=d;if("/"===d)for(;a<p&&n(h.charAt(a),L);)i+=h.charAt(a),a+=1;return[i,"TK_STRING"]}if("#"===c){if(0===j.length&&"!"===h.charAt(a)){for(i=c;a<p&&"\n"!=c;)c=h.charAt(a),i+=c,a+=1;j.push(M(i)+"\n");k();return P()}d="#";if(a<p&&n(h.charAt(a), U)){do c=h.charAt(a),d+=c,a+=1;while(a<p&&"#"!==c&&"="!==c);"#"!==c&&("["===h.charAt(a)&&"]"===h.charAt(a+1)?(d+="[]",a+=2):"{"===h.charAt(a)&&"}"===h.charAt(a+1)&&(d+="{}",a+=2));return[d,"TK_WORD"]}}if("<"===c&&"<\!--"===h.substring(a-1,a+3)){a+=3;for(c="<\!--";"\n"!=h[a]&&a<p;)c+=h[a],a++;b.in_html_comment=!0;return[c,"TK_COMMENT"]}if("-"===c&&b.in_html_comment&&"--\>"===h.substring(a-1,a+2))return b.in_html_comment=!1,a+=2,z&&k(),["--\>","TK_COMMENT"];if(n(c,A)){for(;a<p&&n(c+h.charAt(a),A)&& !(c+=h.charAt(a),a+=1,a>=p););return"="===c?[c,"TK_EQUALS"]:[c,"TK_OPERATOR"]}return[c,"TK_UNKNOWN"]}var h,j,d,e,g,o,t,b,G,v,K,L,A,a,x,U,i,B,J,z,w,s,C="",l=l?l:{},q;void 0!==l.space_after_anon_function&&void 0===l.jslint_happy&&(l.jslint_happy=l.space_after_anon_function);void 0!==l.braces_on_own_line&&(q=l.braces_on_own_line?"expand":"collapse");q=l.brace_style?l.brace_style:q?q:"collapse";t=l.indent_size?l.indent_size:4;x=l.indent_char?l.indent_char:" ";var Q="undefined"===typeof l.preserve_newlines? !0:l.preserve_newlines,T="undefined"===typeof l.max_preserve_newlines?!1:l.max_preserve_newlines,W="undefined"===l.jslint_happy?!1:l.jslint_happy,r="undefined"===typeof l.keep_array_indentation?!1:l.keep_array_indentation,X="undefined"===typeof l.space_before_conditional?!0:l.space_before_conditional,R="undefined"===typeof l.indent_case?!1:l.indent_case;w=!1;var p=y.length;for(v="";0<t;)v+=x,t-=1;for(;y&&(" "===y[0]||"\t"===y[0]);)C+=y[0],y=y.substring(1);h=y;t="";e="TK_START_EXPR";o=g="";j=[];J= !1;K=["\n","\r","\t"," "];L="a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L,M,N,O,P,Q,R,S,T,U,V,W,X,Y,Z,0,1,2,3,4,5,6,7,8,9,_,$".split(",");U="0,1,2,3,4,5,6,7,8,9".split(",");A="+ - * / % & ++ -- = += -= *= /= %= == === != !== > < >= <= >> << >>> >>>= >>= <<= && &= | || ! !! , : ? ^ ^= |= ::";A+=" <%= <% %> <?= <? ?>";A=A.split(" ");x="continue,try,throw,return,var,if,switch,case,default,for,while,break,function".split(",");G=[];u("BLOCK");for(a=0;;){B=P(a);d=B[0];B=B[1]; if("TK_EOF"===B)break;switch(B){case "TK_START_EXPR":if("["===d){if("TK_WORD"===e||")"===g){n(g,x)&&f();u("(EXPRESSION)");m();break}"[EXPRESSION]"===b.mode||"[INDENTED-EXPRESSION]"===b.mode?"]"===o&&","===g?("[EXPRESSION]"===b.mode&&(b.mode="[INDENTED-EXPRESSION]",r||F()),u("[EXPRESSION]"),r||k()):"["===g?("[EXPRESSION]"===b.mode&&(b.mode="[INDENTED-EXPRESSION]",r||F()),u("[EXPRESSION]"),r||k()):u("[EXPRESSION]"):u("[EXPRESSION]")}else"for"===t?u("(FOR-EXPRESSION)"):n(t,["if","while"])?u("(COND-EXPRESSION)"): u("(EXPRESSION)");";"===g||"TK_START_BLOCK"===e?k():"TK_END_EXPR"===e||"TK_START_EXPR"===e||"TK_END_BLOCK"===e||"."===g?z&&k():"TK_WORD"!==e&&"TK_OPERATOR"!==e?f():"function"===t||"typeof"===t?W&&f():(n(g,x)||"catch"===g)&&X&&f();m();break;case "TK_END_EXPR":if("]"===d)if(r){if("}"===g){N();m();I();break}}else if("[INDENTED-EXPRESSION]"===b.mode&&"]"===g){I();k();m();break}I();m();break;case "TK_START_BLOCK":"do"===t?u("DO_BLOCK"):u("BLOCK");"expand"==q||"expand-strict"==q?(o=!1,"expand-strict"== q?(o="}"==O())||k(!0):"TK_OPERATOR"!==e&&("return"===g||"="===g||"throw"===g?f():k(!0)),m(),o||F()):("TK_OPERATOR"!==e&&"TK_START_EXPR"!==e?"TK_START_BLOCK"===e?k():f():E(b.previous_mode)&&","===g&&("}"===o?f():k()),F(),m());break;case "TK_END_BLOCK":I();"expand"==q||"expand-strict"==q?"{"!==g&&k():"TK_START_BLOCK"===e?w?N():D():E(b.mode)&&r?(r=!1,k(),r=!0):k();m();break;case "TK_WORD":if(J){f();m();f();J=!1;break}if("function"===d&&(b.var_line&&(b.var_line_reindented=!0),(w||";"===g)&&"{"!==g&&"TK_BLOCK_COMMENT"!= e&&"TK_COMMENT"!=e)){s=w?s:0;Q||(s=1);for(i=0;i<2-s;i++)k(!1)}if("case"===d||"default"===d){":"===g||b.case_body?N():(R||b.indentation_level--,k(),R||b.indentation_level++);m();b.in_case=!0;b.case_body=!1;break}i="NONE";"TK_END_BLOCK"===e?n(d.toLowerCase(),["else","catch","finally"])?"expand"==q||"end-expand"==q||"expand-strict"==q?i="NEWLINE":(i="SPACE",f()):i="NEWLINE":"TK_SEMICOLON"===e&&("BLOCK"===b.mode||"DO_BLOCK"===b.mode)?i="NEWLINE":"TK_SEMICOLON"===e&&H(b.mode)?i="SPACE":"TK_STRING"===e? i="NEWLINE":"TK_WORD"===e?("else"===g&&D(!0),i="SPACE"):"TK_START_BLOCK"===e?i="NEWLINE":"TK_END_EXPR"===e&&(f(),i="NEWLINE");if(n(d,x)&&")"!==g&&(i="else"==g?"SPACE":"NEWLINE","function"===d&&("get"===g||"set"===g)))i="SPACE";b.if_line&&"TK_END_EXPR"===e&&(b.if_line=!1);if(n(d.toLowerCase(),["else","catch","finally"]))"TK_END_BLOCK"!==e||"expand"==q||"end-expand"==q||"expand-strict"==q?k():(D(!0),f());else if("NEWLINE"===i){if(!(("TK_START_EXPR"===e||"="===g||","===g)&&"function"===d))if("function"=== d&&"new"==g)f();else if("return"===g||"throw"===g)f();else if("TK_END_EXPR"!==e){if(("TK_START_EXPR"!==e||"var"!==d)&&":"!==g)"if"===d&&"else"===t&&"{"!==g?f():(b.var_line=!1,b.var_line_reindented=!1,k())}else n(d,x)&&")"!=g&&(b.var_line=!1,b.var_line_reindented=!1,k())}else E(b.mode)&&","===g&&"}"===o?k():"SPACE"===i&&f();m();t=d;"var"===d&&(b.var_line=!0,b.var_line_reindented=!1,b.var_line_tainted=!1);"if"===d&&(b.if_line=!0);"else"===d&&(b.if_line=!1);break;case "TK_SEMICOLON":m();b.var_line=!1; b.var_line_reindented=!1;"OBJECT"==b.mode&&(b.mode="BLOCK");break;case "TK_STRING":"TK_END_EXPR"===e&&n(b.previous_mode,["(COND-EXPRESSION)","(FOR-EXPRESSION)"])?f():"TK_STRING"==e||"TK_START_BLOCK"===e||"TK_END_BLOCK"===e||"TK_SEMICOLON"===e?k():"TK_WORD"===e&&f();m();break;case "TK_EQUALS":b.var_line&&(b.var_line_tainted=!0);f();m();f();break;case "TK_OPERATOR":i=o=!0;b.var_line&&","===d&&H(b.mode)&&(b.var_line_tainted=!1);if(b.var_line&&","===d)if(b.var_line_tainted){m();b.var_line_reindented= !0;b.var_line_tainted=!1;k();break}else b.var_line_tainted=!1;if("return"===g||"throw"===g){f();m();break}if(":"===d&&b.in_case){R&&(b.case_body=!0);m();k();b.in_case=!1;break}if("::"===d){m();break}if(","===d){b.var_line?b.var_line_tainted?(m(),k(),b.var_line_tainted=!1):(m(),f()):"TK_END_BLOCK"===e&&"(EXPRESSION)"!==b.mode?(m(),"OBJECT"===b.mode&&"}"===g?k():f()):"OBJECT"===b.mode?(m(),k()):(m(),f());break}else n(d,["--","++","!"])||n(d,["-","+"])&&(n(e,["TK_START_BLOCK","TK_START_EXPR","TK_EQUALS", "TK_OPERATOR"])||n(g,x))?(i=o=!1,";"===g&&H(b.mode)&&(o=!0),"TK_WORD"===e&&n(g,x)&&(o=!0),"BLOCK"===b.mode&&("{"===g||";"===g)&&k()):"."===d?o=!1:":"===d?0==b.ternary_depth?(b.mode="OBJECT",o=!1):b.ternary_depth-=1:"?"===d&&(b.ternary_depth+=1);o&&f();m();i&&f();break;case "TK_BLOCK_COMMENT":o=d.split(/\x0a|\x0d\x0a/);if(V(o.slice(1),"*")){k();j.push(o[0]);for(i=1;i<o.length;i++)k(),j.push(" "),j.push(M(o[i]))}else{1<o.length?k():"TK_END_BLOCK"===e?k():f();for(i=0;i<o.length;i++)j.push(o[i]),j.push("\n")}"\n"!= O("\n")&&k();break;case "TK_INLINE_COMMENT":f();m();H(b.mode)?f():S();break;case "TK_COMMENT":z?k():f();m();"\n"!=O("\n")&&S();break;case "TK_UNKNOWN":("return"===g||"throw"===g)&&f(),m()}o=g;e=B;g=d}return C+j.join("").replace(/[\n ]+$/,"")}"undefined"!==typeof exports&&(exports.js_beautify=js_beautify);